# Task Time Tracker Chrome Extension

BacklogとGitHubのタスクの作業時間を自動で計測するChrome拡張機能です。

## 機能概要

- **自動時間計測**: タスクのステータス変更を自動検知して作業時間を計算
- **複数サービス対応**: Backlog、GitHub Issues/Projects に対応
- **最小限の操作**: 基本的に設定後は自動で動作（通知なし）
- **詳細レポート**: 日次・週次の作業時間サマリーを表示
- **カスタマイズ可能**: 計測対象ステータスの設定が可能

## 対応サービスと処理内容

### Backlog（*.backlog.jp / *.backlog.com）

#### 検知方式
- **DOM Mutation監視**: カンバンボードでのドラッグ&ドロップを検出
- **ポインター監視**: マウスイベントでタスク移動を追跡
- **React Beautiful DnD対応**: Backlogのカンバンシステムに最適化

#### 処理内容
1. **タスク検知**
   - `[data-react-beautiful-dnd-draggable]` 要素を監視
   - `a.card-label[href*="/view/"]` から課題キー（TEST-123等）を抽出
   - `.card-summary` からタスクタイトルを取得

2. **ステータス判定**
   - 列ヘッダー（`.SlotHead`）からステータス名を抽出
   - 位置ベース判定でタスクの現在列を特定
   - 「処理中」ステータスで計測開始（デフォルト）

3. **スペース・プロジェクト情報**
   - URL から `spaceId` を自動抽出
   - カンバンボードのプロジェクト名を取得

#### 対応しているBacklogの機能
- カンバンボードでのタスク移動
- 複数ステータス列の管理
- CSS-in-JSクラス名の変更に対応

### GitHub（github.com）

#### 検知方式
- **DOM Mutation監視**: GitHub ProjectsのSPA更新を検出
- **ポインター監視**: カード移動イベントの追跡
- **ネットワーク監視**: GitHub APIレスポンスの監視

#### 処理内容
1. **タスク検知**
   - `[data-board-card-id]` でGitHub Projectsカードを特定
   - Issue/PRタイトルとIDを抽出
   - カード移動時の列変更を検出

2. **ステータス判定**
   - GitHub Projectsの列名から状態を判定
   - 「now」列で計測開始（デフォルト設定）
   - SPA形式のページ更新に対応

3. **プロジェクト情報**
   - GitHub ProjectsのURLからプロジェクト情報を抽出
   - リポジトリ名とユーザー名を取得

#### 対応しているGitHubの機能
- GitHub Projects（新版）のカンバンボード
- Issues/Pull Requestsの状態管理
- Single Page Application（SPA）の動的更新

## アプリ機能詳細

### バックグラウンド処理（background.js）
- **タイマー管理**: アクティブなタスクタイマーの制御
- **データ永続化**: Chrome Storage APIでローカル保存
- **メッセージハンドリング**: コンテンツスクリプトとの通信
- **時間集計**: 日次・週次・タスク別の時間計算
- **バッジ表示**: アクティブタイマー数をアイコンバッジに表示

### ポップアップUI（popup.html/js/css）
- **アクティブタイマー表示**: 現在実行中のタスク一覧
- **時間サマリー**: 今日・今週の作業時間
- **設定画面**: 計測対象ステータスのカスタマイズ
- **詳細レポート**: タスク別の作業時間詳細

### 開発者ツール統合（devtools.html/js）
- **ネットワーク監視**: APIリクエストの詳細ログ
- **デバッグ機能**: タスク検知の動作確認

## インストール方法

### 1. 開発版インストール

1. このリポジトリをクローン
```bash
git clone https://github.com/masaway/task-manage-extention.git
cd task-manage-extention
```

2. Chromeの拡張機能管理画面を開く
   - Chrome で `chrome://extensions/` にアクセス
   - 右上の「デベロッパーモード」を有効にする

3. 拡張機能を読み込む
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - ダウンロードしたフォルダを選択

### 2. 初期設定

1. 拡張機能アイコンをクリック
2. 「設定」ボタンをクリック
3. 計測開始ステータスを設定
   - **Backlog**: 「処理中」（デフォルト）
   - **GitHub**: 「now」（デフォルト）

## 使用方法

### 基本的な使い方

1. 普段通りBacklogやGitHubでタスクを操作
2. 設定したステータスに変更すると自動で計測開始
3. 他のステータスに変更すると自動で計測終了
4. 拡張機能アイコンのバッジで実行中タスク数を確認

### 時間の確認

- **拡張機能バッジ**: 実行中のタスク数を表示
- **ポップアップ**: 今日・今週の作業時間サマリー
- **詳細レポート**: タスク別の作業時間詳細

## 技術仕様

### アーキテクチャ
- **Manifest Version**: 3
- **Service Worker**: バックグラウンドでのタイマー管理
- **Content Scripts**: 各サービスのページ監視
- **Popup**: ユーザーインターフェース

### 権限
- `storage`: 設定とデータの保存
- `activeTab`: アクティブタブの情報取得
- `scripting`: コンテンツスクリプトの動的注入
- `webRequest`: ネットワークリクエストの監視

### データ保存
すべてのデータはユーザーの端末内にローカル保存：
- **設定データ**: ステータス設定
- **時間ログ**: タスクごとの作業時間記録
- **アクティブタイマー**: 現在実行中のタスク情報

## ファイル構成

```
task-manage-extention/
├── manifest.json              # 拡張機能の設定
├── src/
│   ├── scripts/
│   │   ├── background.js           # バックグラウンド処理
│   │   ├── content-backlog-v8.js   # Backlog用検知システム
│   │   └── content-github-v3.js    # GitHub用検知システム
│   ├── popup/
│   │   ├── popup.html              # ポップアップUI
│   │   ├── popup.css               # ポップアップスタイル
│   │   └── popup.js                # ポップアップロジック
│   ├── devtools/
│   │   ├── devtools.html           # 開発者ツール統合
│   │   └── devtools.js             # ネットワーク監視
│   └── icons/
│       ├── icon16.png              # 16x16アイコン
│       ├── icon48.png              # 48x48アイコン
│       └── icon128.png             # 128x128アイコン
├── CLAUDE.md                       # 開発ガイドライン
└── README.md                       # このファイル
```

## 設定オプション

### ステータス設定
各サービスで計測対象とするステータスを設定：
- **Backlog**: 「処理中」「レビュー」等
- **GitHub**: 「now」「In Progress」等

### その他設定
- **非アクティブ時間の除外**: 長時間操作がない場合の計測調整

## トラブルシューティング

### 時間が計測されない場合

1. **ステータス設定を確認**
   - 実際のステータス名と設定が一致しているか
   - 大文字小文字、スペースが正確か

2. **対象ページで動作確認**
   - 拡張機能が有効になっているか
   - 対象URLでコンテンツスクリプトが読み込まれているか

3. **デバッグ確認**
   - F12 > Console でエラーログを確認
   - DevTools拡張でネットワーク監視状況を確認

### データが消えた場合
- Chrome Storage API使用のため、Chromeのデータ削除でリセットされる可能性があります
- 重要なデータは定期的にエクスポート（今後実装予定）でバックアップ推奨

## 開発・貢献

### デバッグ機能
- **DevTools拡張**: ネットワーク監視とAPIログ
- **コンソールログ**: 本番環境では無効化済み
- **グローバル関数**: デバッグ用のヘルパー関数

### 今後の改善予定
- [ ] データエクスポート/インポート機能
- [ ] 時間の手動調整機能
- [ ] より詳細なレポート機能
- [ ] 他のプロジェクト管理ツール対応
- [ ] 時間の可視化グラフ

## ライセンス

MIT License

## 貢献

バグ報告や機能要望は Issues でお願いします。プルリクエストも歓迎します。

---

**注意**: この拡張機能は通知を一切出さず、静かに動作します。アクティブなタイマーの確認は拡張機能アイコンのバッジまたはポップアップから行ってください。